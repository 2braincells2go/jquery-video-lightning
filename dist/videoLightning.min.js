/*
 *  jQuery Video Lightning - v2.0.1
 *  Turn any element into a lightbox or popover link for Youtube and Vimeo videos.
 *  https://github.com/musocrat/jquery-video-lightning
 *
 *  Made by Andrew Carpenter
 *  Under MIT License
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};!function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return E=b,F=function(a){return function(b){var d,e,f,g,h,i,j,k,l,m,o,s,u,v,w,x,y,A;if(v=function(){console.error("VideoLightning was initialized without elements.")},w=b.elements||b.element,!w)return v();if(y=[],h=[],x=function(a){var b;return t(a)?y.push({el:a,opts:null}):(b=z(a),y.push({el:b,opts:a[b]||null}))},q(w))for(i=0,l=w.length;l>i;i++)f=w[i],x(f);else x(w);for(j=0,m=y.length;m>j;j++)if(g=y[j],e=n(g.el))if(r(e))for(k=0,o=e.length;o>k;k++)d=e[k],h.push({el:d,opts:g.opts});else h.push({el:e},g.opts);if(0===h.length)return v();for(A=b.settings||{},u=0,s=h.length;s>u;u++)g=h[u],a.vlData.instances.push(new c(g,A));p()}}(this),c=function(){function b(b,c){this.elObj=b,this.vmStop=a(this.vmStop,this),this.vmPlay=a(this.vmPlay,this),this.vmListen=a(this.vmListen,this),this.initPlayerVM=a(this.initPlayerVM,this),this.coverYT=a(this.coverYT,this),this.ytState=a(this.ytState,this),this.ytStop=a(this.ytStop,this),this.ytPlay=a(this.ytPlay,this),this.setYTPlayer=a(this.setYTPlayer,this),this.initPlayerYT=a(this.initPlayerYT,this),this.cover=a(this.cover,this),this.hide=a(this.hide,this),this.show=a(this.show,this),this.clear=a(this.clear,this),this.stop=a(this.stop,this),this.play=a(this.play,this),this.peek=a(this.peek,this),this.hovered=a(this.hovered,this),this.clicked=a(this.clicked,this),this.regEvents=a(this.regEvents,this),this.resize=a(this.resize,this),this.popoverPos=a(this.popoverPos,this),this.buildEls=a(this.buildEls,this),this.buildOpts=a(this.buildOpts,this),this.opts=h({},c),this.inst=w(),this.el=this.elObj.el,this.buildOpts(),this.buildEls(),d(this.opts.cover,!1)&&this.cover(),this.regEvents()}return b.prototype.buildOpts=function(){var a,b,c,d,e,f,g,i,j,k,l,m;k=[["backdrop_color","bdColor"],["backdrop_opacity","bdOpacity"],["ease_in","fadeIn"],["ease_out","fadeOut"],["glow_color","glowColor"],["start_time","startTime"],["z_index","zIndex"],["rick_roll","rickRoll"],["iv_load_policy","ivLoadPolicy"]],h(this.opts,this.elObj.opts),c=this.el.dataset,j=function(a){return function(b,c){return a.opts[b.replace(/^video(.)(.*)/,function(a,b,c){return b.toLowerCase()+c})]=c}}(this);for(e in c)m=c[e],j(e,m);for(this.opts.width=this.opts.width?parseInt(this.opts.width,10):640,this.opts.height=this.opts.height?parseInt(this.opts.height,10):390,null==(a=this.opts).id&&(a.id="y-dQw4w9WgXcQ"),this.opts.id.match(/^v/)?(this.vendor="vimeo",this.vm=!0):(this.vendor="youtube",this.yt=!0),window.vlData[this.vendor]=!0,this.id=this.opts.id.replace(/([vy]-)/i,""),l=[],d=0,g=k.length;g>d;d++)f=k[d],l.push(null!=(b=this.opts)[i=f[1]]?b[i]:b[i]=this.opts[f[0]]);return l},b.prototype.buildEls=function(){var a,b,c,f,h,i,j,k,n;return(this.target=E.createElement("span")).className="video-target",this.el.parentNode.insertBefore(this.target,this.el),this.target.appendChild(this.el),b=e(A(this.opts.bdColor,"#ddd")),c=A(this.opts.bdOpacity,.6),a="background: rgba("+b.r+", "+b.g+", "+b.b+", "+c+")};",f="width: "+this.opts.width+"px; height: "+this.opts.height+"px;",i="margin-top: -"+this.opts.height/2+"px; margin-left: -"+this.opts.width/2+"px;",h="box-shadow: 0px 0px "+(j=A(this.opts.glow,20))+"px "+j/5+"px "+m(A(this.opts.glowColor,"#000"))+";",k=d(this.opts.popover,!1)?C(this.opts.width,this.opts.height):B,n=d(this.opts.popover,!1)?"background: "+m(A(this.opts.xBgColor,"#000"))+"; color: "+m(A(this.opts.xColor,"#fff"))+";":"display: none;",this.target.insertAdjacentHTML("beforeend",g({tag:"div",attrs:{id:"wrap_"+this.inst,"class":"video-wrapper",style:k+" "+a+" z-index: "+A(this.opts.zIndex,2100)+"; opacity: 0;"},children:[{tag:"div",attrs:{"class":"video-frame",style:l+" "+f+" "+i+" "+h},children:[{tag:"div",attrs:{"class":"video"},children:[{tag:"iframe",attrs:{type:"text/html",id:"iframe_"+this.inst,"class":"video-iframe"}}]}]},{tag:"div",inner:"&times;",attrs:{id:"close_"+this.inst,"class":"video-close",style:"float: right; margin-right: -34px; "+h+" "+n+" padding: 0 10px 0 12px; font-size: 25px;"}}]})),this.wrapper=E.getElementById("wrap_"+this.inst),this.iframe=E.getElementById("iframe_"+this.inst),this.close=E.getElementById("close_"+this.inst)},b.prototype.popoverPos=function(){var a;return a=o(this.target,this.opts.width,this.opts.height,this.opts.fluidity),this.wrapper.style.left=a.x+"px",this.wrapper.style.top=a.y+"px"},b.prototype.resize=function(){var a;return!window.vlData.throttle&&(this.popoverPos(),this.opts.throttle)?(window.vlData.throttle=!0,a=function(){return window.vlData.throttle=!1},setTimeout(a,this.opts.throttle)):void 0},b.prototype.regEvents=function(){return this.target.style.cursor="pointer",this.target.addEventListener("mouseup",this.clicked,!1),d(this.opts.popover,!1)&&(window.addEventListener("resize",this.resize,!1),window.addEventListener("scroll",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1),this.opts.peek)?(this.target.addEventListener("mouseenter",this.hovered,!1),this.target.addEventListener("mouseleave",this.hovered,!1)):void 0},b.prototype.clicked=function(a){if(this.peeking)return this.peek(!1,!0);if(!(a.buttons&&1!==a.buttons||a.which&&1!==a.which||a.button&&1!==a.button))return this.playing?this.stop():this.play()},b.prototype.hovered=function(a){return"mouseenter"!==a.type||this.playing||this.peek(),"mouseleave"===a.type&&this.playing?this.peek(this.peeking):void 0},b.prototype.peek=function(a,b){return null==a&&(a=!1),null==b&&(b=!1),this.peeking||!this.playing?(this.close.innerHTML=a||b?"&times;":"&#94;",this.peeking=!(a||b),a?this.stop():b?null:this.play()):void 0},b.prototype.play=function(){d(this.opts.popover,!1)&&this.popoverPos(),this.show(),this.ready&&!this.playing&&"about:blank"!==this.iframe.src?(this.yt&&this.ytPlay(),this.vm&&this.vmPlay()):this.playing||(this.vm&&this.initPlayerVM(),this.yt&&this.initPlayerYT()),this.playing=!0,this.clearAfter&&window.clearTimeout(this.clearAfter)},b.prototype.stop=function(a){null==a&&(a=0),d(this.opts.rickRoll,!1)||(this.hide(a),this.ready?(this.yt&&this.ytStop(),this.vm&&this.vmStop()):this.clear(),this.playing=!1,d(this.opts.unload,!0)&&(this.clearAfter=window.setTimeout(this.clear,1e3*(A(this.opts.unloadAfter)||45))))},b.prototype.clear=function(){this.iframe.src="about:blank"},b.prototype.show=function(){j(this.wrapper,A(this.opts.fadeIn,300))},b.prototype.hide=function(a){null==a&&(a=0),k(this.wrapper,A(this.opts.fadeOut,a))},b.prototype.cover=function(){this.yt&&this.coverYT()},b.prototype.initPlayerYT=function(){return x(this.iframe,{url:location.protocol+"//www.youtube.com/embed/"+this.id,params:{enablejsapi:1,autoplay:A(this.opts.autoplay,1),autohide:A(this.opts.autohide,2),cc_load_policy:A(this.opts.ccLoadPolicy,0),color:A(this.opts.color,null),controls:A(this.opts.controls,2),disablekb:A(this.opts.disablekb,0),end:A(this.opts.endTime,null),fs:A(this.opts.fs,1),hl:A(this.opts.hl,"en"),iv_load_policy:A(this.opts.ivLoadPolicy,1),list:A(this.opts.list,null),listType:A(this.opts.listType,null),loop:A(this.opts.loop,0),modestbranding:A(this.opts.modestbranding,0),origin:encodeURIComponent(A(this.opts.origin,location.protocol+"//"+location.host)),playerapiid:this.inst,playlist:A(this.opts.playlist,null),playsinline:A(this.opts.playsinline,0),rel:A(this.opts.rel,0),showinfo:A(this.opts.showinfo,1),start:A(this.opts.startTime,0),theme:A(this.opts.theme,null)},attrs:{width:this.opts.width,height:this.opts.height,frameBorder:0}}),window.vlData.ytAPIReady?this.setYTPlayer():void 0},b.prototype.setYTPlayer=function(){var a;return a=function(a){return function(){return a.ready=!0}}(this),null!=this.ytPlayer?this.ytPlayer:this.ytPlayer=new YT.Player("iframe_"+this.inst,{events:{onReady:a,onStateChange:this.ytState}})},b.prototype.ytPlay=function(){return this.ytPlayer.playVideo()},b.prototype.ytStop=function(){return D(this.ytPlayer,this.opts.startTime),this.ytPlayer.stopVideo(),this.ytPlayer.clearVideo()},b.prototype.ytState=function(a){return 0===a.data&&d(this.opts.autoclose,!0)?this.stop(A(this.opts.fadeOut,1e3)):void 0},b.prototype.coverYT=function(){this.ytCover=f(this.target,"//img.youtube.com/vi/"+this.id+"/hqdefault.jpg")},b.prototype.initPlayerVM=function(){return x(this.iframe,{url:location.protocol+"//player.vimeo.com/video/"+this.id,params:{autoplay:A(this.opts.autoplay,1),loop:A(this.opts.loop,0),title:A(this.opts.showinfo,1),byline:A(this.opts.byline,1),portrait:A(this.opts.portrait,1),color:v(A(this.opts.color,"#00adef")),api:1,player_id:this.inst},attrs:{width:this.opts.width,height:this.opts.height,frameBorder:0}}),window.addEventListener("message",this.vmListen,!1),null!=this.vmPlayer?this.vmPlayer:this.vmPlayer=this.iframe},b.prototype.vmListen=function(a){var b;if(b=JSON.parse(a.data),b.player_id===this.inst)switch(b.event){case"ready":this.ready=!0,u(this.vmPlayer,this.id,"addEventListener","finish");break;case"finish":this.stop(1e3)}},b.prototype.vmPlay=function(){u(this.vmPlayer,this.id,"play")},b.prototype.vmStop=function(){u(this.vmPlayer,this.id,"pause")},b}(),A=function(a,b){return a===!1||"false"===a||0===a||"0"===a?a:a||b},d=function(a,b){return a===!1||"false"===a||0===a||"0"===a?!1:!!a||b},g=function(a){var b,c,d,e,f,h,i,j,k;if(b="",d="",a.attrs){i=a.attrs;for(f in i)k=i[f],b+=" "+f+'="'+k+'"'}if(a.children)for(j=a.children,e=0,h=j.length;h>e;e++)c=j[e],d+=s(c)?g(c):c;return"<"+a.tag+b+">"+(a.inner||d)+"</"+a.tag+">"},x=function(a,b){var c,d,e,f,g,h;g=b.url+"?",d=b.params;for(c in d)h=d[c],null!==h&&(g+="&"+c+"="+h);a.src=g.replace(/&/,""),e=b.attrs,f=[];for(c in e)h=e[c],f.push(a[c]=h);return f},h=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},t=function(a){return"string"==typeof a},q=function(a){return a instanceof Array},r=function(a){return a instanceof HTMLCollection},s=function(a){return null!==a&&"object"==typeof a},z=function(a){var b,c;for(b in a)return c=a[b],b},n=function(a){var b;return b="#"===a.charAt(0)?E.getElementById(a.substr(1)):E.getElementsByClassName(a.substr(1)),q(b)&&0===b.length?null:b},w=function(){return(Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)).substring(0,16)},v=function(a){return a=a.replace(/^#/,""),3===a.length?""+a+a:a},m=function(a){return"#"+v(a)},e=function(a){return{r:parseInt(v(a).substring(0,2),16),g:parseInt(v(a).substring(2,4),16),b:parseInt(v(a).substring(4,6),16)}},B="display: none; position: fixed; min-width: 100%; min-height: 100%; top: 0; right: 0; bottom: 0; left: 0;",C=function(a,b){return"display: none; position: fixed; width: "+a+"px; height: "+b+"px;"},l="position: absolute; top: 50%; left: 50%; background: #000000;",i=function(a,b){return a.style.transition=a.style.mozTransition=a.style.webkitTransition="opacity "+b+"ms ease"},j=function(a,b){var c;return i(a,b),a.style.display="block",c=function(){return a.style.opacity=1},setTimeout(c,20)},k=function(a,b){var c;return i(a,b),a.style.opacity=0,c=function(){return a.style.display="none"},setTimeout(c,b)},p=function(){var a,c,d;E.getElementById("ytScript")||(a=E.getElementsByTagName("script")[0],c=b.createElement("script"),c.innerHTML="function onYouTubeIframeAPIReady() {vlData.ytReady()};",a.parentNode.insertBefore(c,a),d=b.createElement("script"),d.id="ytScript",d.async=!0,d.src=location.protocol+"//www.youtube.com/iframe_api",c.parentNode.insertBefore(d,c.nextSibling))},D=function(a,b){null==b&&(b=0),a.getDuration()-3<a.getCurrentTime()&&(a.pauseVideo(),a.seekTo(b,!1))},u=function(a,b,c,d){var e;return null==d&&(d=null),e=d?{method:c,value:d}:{method:c},a.contentWindow.postMessage(JSON.stringify(e),location.protocol+"//player.vimeo.com/video/"+b)},f=function(a,b){var c;return c=E.createElement("img"),c.className="video-link",c.src=b,a.appendChild(c),c},y=function(){var a;return(a=b.getElementById("vl-size-test"))||(a=b.createElement("div"),a.id="vl-size-test",a.style.cssText="position:fixed;top:0;left:0;bottom:0;right:0;visibility:hidden;",b.body.appendChild(a)),{width:a.offsetWidth,height:a.offsetHeight}},o=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;for(null==d&&(d=30),g=a.getBoundingClientRect(),f={x:(k=y().width)/2,y:(j=y().height)/2},e={x:b/2,y:c/2},l=[],t=h=m=g.left,n=g.right+b,o=d;o>0?n>=h:h>=n;t=h+=o)l.push([t-b,g.top-c]),l.push([t-b,g.bottom]);for(u=i=p=g.top,q=g.bottom+c,r=d;r>0?q>=i:i>=q;u=i+=r)l.push([g.left-b,u-c]),l.push([g.right,u-c]);return s=function(a,d){var g,h,i,l,m,n,o,p;for(p=[[a,n={}],[d,o={}]],l=0,m=p.length;m>l;l++)g=p[l],t=g[0][0],u=g[0][1],g[1].diffx=(h=t+e.x)>f.x?h-f.x:f.x-h,g[1].diffy=(i=u+e.y)>f.y?i-f.y:f.y-i,g[1].diff=g[1].diffx+g[1].diffy,(0>t||t+b>k)&&(g[1].diff+=1e4),(0>u||u+c>j)&&(g[1].diff+=1e4);return n.diff-o.diff},l.sort(s),{x:parseInt((t=l[0][0])<0||t+b>k?f.x-e.x:t,10),y:parseInt((u=l[0][1])<0||u+c>j?f.y-e.y:u,10)}},this.videoLightning=F,this.vlData={},this.vlData.instances=[],this.vlData.ytReady=function(a){return function(){return a.vlData.ytAPIReady=!0}}(this),this.vlData.youtube=this.vlData.vimeo=!1,"undefined"!=typeof $?$.fn.jqueryVideoLightning=function(a){return this.each(function(){var b;$.data(this,"plugin_jqueryVideoLightning")||(b=new c({el:this,opts:a}),vlData.instances.push(b),$.data(this,"plugin_jqueryVideoLightning",b))}),p()}:void 0}(document)}).call(this);