/*
 *  jQuery Video Lightning - v2.0.1
 *  Turn any element into a lightbox or popover link for Youtube and Vimeo videos.
 *  https://github.com/musocrat/jquery-video-lightning
 *
 *  Made by Andrew Carpenter
 *  Under MIT License
 */
(function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};!function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F=this;return d=b,e=function(a){var b,d,e,f,g,h,i,j,k,l,m,n,o,q,u,w,x,y;if(h=function(){console.error("VideoLightning was initialized without elements.")},i=a.elements||a.element,!i)return h();if(k=[],g=[],j=function(a){var b;return v(a)?k.push({el:a,opts:null}):(b=A(a),k.push({el:b,opts:a[b]||null}))},s(i))for(m=0,u=i.length;u>m;m++)e=i[m],j(e);else j(i);for(n=0,w=k.length;w>n;n++)if(f=k[n],d=p(f.el))if(t(d))for(o=0,x=d.length;x>o;o++)b=d[o],g.push({el:b,opts:f.opts});else g.push({el:d},f.opts);if(0===g.length)return h();for(l=a.settings||{},q=0,y=g.length;y>q;q++)f=g[q],F.vlData.instances.push(new c(f,l));r()},c=function(){function b(b,c){this.elObj=b,this.vmStop=a(this.vmStop,this),this.vmPlay=a(this.vmPlay,this),this.vmListen=a(this.vmListen,this),this.initPlayerVM=a(this.initPlayerVM,this),this.coverYT=a(this.coverYT,this),this.ytState=a(this.ytState,this),this.ytStop=a(this.ytStop,this),this.ytPlay=a(this.ytPlay,this),this.initPlayerYT=a(this.initPlayerYT,this),this.cover=a(this.cover,this),this.hide=a(this.hide,this),this.show=a(this.show,this),this.stop=a(this.stop,this),this.play=a(this.play,this),this.peek=a(this.peek,this),this.hovered=a(this.hovered,this),this.clicked=a(this.clicked,this),this.regEvents=a(this.regEvents,this),this.resize=a(this.resize,this),this.popoverPos=a(this.popoverPos,this),this.buildEls=a(this.buildEls,this),this.buildOpts=a(this.buildOpts,this),this.opts=j({},c),this.inst=y(),this.el=this.elObj.el,this.buildOpts(),this.buildEls(),f(this.opts.cover,!1)&&this.cover(),this.vm&&this.initPlayerVM()}return b.prototype.buildOpts=function(){var a,b,c,d,e,f=this;j(this.opts,this.elObj.opts),a=this.el.dataset,c=function(a,b){return f.opts[a.replace(/^video(.)(.*)/,function(a,b,c){return b.toLowerCase()+c})]=b};for(b in a)d=a[b],c(b,d);return this.opts.width=this.opts.width?parseInt(this.opts.width,10):640,this.opts.height=this.opts.height?parseInt(this.opts.height,10):390,null==(e=this.opts).id&&(e.id="y-dQw4w9WgXcQ"),this.opts.id.match(/^v/)?(this.vendor="vimeo",this.vm=!0):(this.vendor="youtube",this.yt=!0),window.vlData[this.vendor]=!0,this.id=this.opts.id.replace(/([vy]-)/i,"")},b.prototype.buildEls=function(){var a,b,c,e,f,h,j,k,l;return(this.target=d.createElement("span")).className="video-target",this.el.parentNode.insertBefore(this.target,this.el),this.target.appendChild(this.el),b=g(B(this.opts.bdColor,"#ddd")),c=B(this.opts.bdOpacity,.6),a="background: rgba("+b.r+", "+b.g+", "+b.b+", "+c+")};",e="width: "+this.opts.width+"px; height: "+this.opts.height+"px;",h="margin-top: -"+this.opts.height/2+"px; margin-left: -"+this.opts.width/2+"px;",f="box-shadow: 0px 0px "+(j=B(this.opts.glow,20))+"px "+j/5+"px "+o(B(this.opts.glowColor,"#000"))+";",k=this.opts.popover?D(this.opts.width,this.opts.height):C,l=this.opts.popover?"background: "+o(B(this.opts.xBgColor,"#000"))+"; color: "+o(B(this.opts.xColor,"#fff"))+";":"display: none;",this.target.insertAdjacentHTML("beforeend",i({tag:"div",attrs:{id:"wrap_"+this.inst,"class":"video-wrapper",style:""+k+" "+a+" z-index: "+B(this.opts.zIndex,2100)+"; opacity: 0;"},children:[{tag:"div",attrs:{"class":"video-frame",style:""+n+" "+e+" "+h+" "+f},children:[{tag:"div",attrs:{"class":"video"},children:[{tag:""+(this.yt?"div":"iframe"),attrs:{id:"iframe_"+this.inst,"class":"video-iframe"}}]}]},{tag:"div",inner:"&times;",attrs:{id:"close_"+this.inst,"class":"video-close",style:"float: right; margin-right: -34px; "+f+" "+l+" padding: 0 10px 0 12px; font-size: 25px;"}}]})),this.wrapper=d.getElementById("wrap_"+this.inst),this.iframe=d.getElementById("iframe_"+this.inst),this.close=d.getElementById("close_"+this.inst)},b.prototype.popoverPos=function(){var a;return a=q(this.target,this.opts.width,this.opts.height,this.opts.fluidity),this.wrapper.style.left=""+a.x+"px",this.wrapper.style.top=""+a.y+"px"},b.prototype.resize=function(){var a;return!window.vlData.throttle&&(this.popoverPos(),this.opts.throttle)?(window.vlData.throttle=!0,a=function(){return window.vlData.throttle=!1},setTimeout(a,this.opts.throttle)):void 0},b.prototype.regEvents=function(){return this.target.style.cursor="pointer",this.target.addEventListener("mouseup",this.clicked,!1),this.opts.popover&&(window.addEventListener("resize",this.resize,!1),window.addEventListener("scroll",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1),this.opts.peek)?(this.target.addEventListener("mouseenter",this.hovered,!1),this.target.addEventListener("mouseleave",this.hovered,!1)):void 0},b.prototype.clicked=function(a){if(this.peeking)return this.peek(!1,!0);if(!(a.buttons&&1!==a.buttons||a.which&&1!==a.which||a.button&&1!==a.button))return this.playing?this.stop():this.play()},b.prototype.hovered=function(a){return"mouseenter"!==a.type||this.playing||this.peek(),"mouseleave"===a.type&&this.playing?this.peek(this.peeking):void 0},b.prototype.peek=function(a,b){return null==a&&(a=!1),null==b&&(b=!1),this.peeking||!this.playing?(this.close.innerHTML=a||b?"&times;":"&#94;",this.peeking=!(a||b),a?this.stop():b?null:this.play()):void 0},b.prototype.play=function(){this.opts.popover&&this.popoverPos(),this.show(),f(this.opts.autoplay,!0)&&(this.yt&&this.ytPlay(),this.vm&&this.vmPlay()),this.playing=!0},b.prototype.stop=function(a){null==a&&(a=0),this.opts.rickRoll||(this.hide(a),this.yt&&this.ytStop(),this.vm&&this.vmStop(),this.playing=!1)},b.prototype.show=function(){l(this.wrapper,B(this.opts.fadeIn,300))},b.prototype.hide=function(a){null==a&&(a=0),m(this.wrapper,B(this.opts.fadeOut,a))},b.prototype.cover=function(){this.yt&&this.coverYT()},b.prototype.initPlayerYT=function(){return this.ytPlayer=new YT.Player("iframe_"+this.inst,{width:this.opts.width,height:this.opts.height,videoId:this.id,playerVars:{enablejsapi:1,autoplay:0,autohide:B(this.opts.autohide,2),cc_load_policy:B(this.opts.ccLoadPolicy,0),color:B(this.opts.color,null),controls:B(this.opts.controls,2),disablekb:B(this.opts.disablekb,0),end:B(this.opts.endTime,null),fs:B(this.opts.fs,1),hl:B(this.opts.hl,"en"),iv_load_policy:B(this.opts.ivLoadPolicy,1),list:B(this.opts.list,null),listType:B(this.opts.listType,null),loop:B(this.opts.loop,0),modestbranding:B(this.opts.modestbranding,0),origin:B(this.opts.origin,""+location.protocol+"//"+location.host),playerapiid:this.inst,playlist:B(this.opts.playlist,null),playsinline:B(this.opts.playsinline,0),rel:B(this.opts.rel,0),showinfo:B(this.opts.showinfo,1),start:B(this.opts.startTime,0),theme:B(this.opts.theme,null)},events:{onReady:this.regEvents,onStateChange:this.ytState}})},b.prototype.ytPlay=function(){return this.ytPlayer.playVideo()},b.prototype.ytStop=function(){return E(this.ytPlayer,this.opts.startTime),this.ytPlayer.stopVideo(),this.ytPlayer.clearVideo()},b.prototype.ytState=function(a){return 0===a.data&&f(this.opts.autoclose,!0)?this.stop(B(this.opts.fadeOut,1e3)):void 0},b.prototype.coverYT=function(){this.ytCover=h(this.target,"//img.youtube.com/vi/"+this.id+"/hqdefault.jpg")},b.prototype.initPlayerVM=function(){var a;return a="http://player.vimeo.com/video/"+this.id+"?autoplay=0&"+("loop="+B(this.opts.loop,0)+"&title="+B(this.opts.showinfo,1)+"&")+("byline="+B(this.opts.byline,1)+"&")+("portrait="+B(this.opts.portrait,1)+"&")+("color="+x(B(this.opts.color,"#00adef")))+("api=1&player_id="+this.inst),this.iframe.setAttribute("allowFullScreen","1"),this.iframe.width=this.opts.width,this.iframe.height=this.opts.height,this.iframe.frameBorder=0,this.iframe.src=a,window.addEventListener("message",this.vmListen,!1),this.vmPlayer=this.iframe},b.prototype.vmListen=function(a){var b;if(b=JSON.parse(a.data),b.player_id===this.inst)switch(b.event){case"ready":this.regEvents(),w(this.vmPlayer,this.id,"addEventListener","finish");break;case"finish":this.stop(1e3)}},b.prototype.vmPlay=function(){w(this.vmPlayer,this.id,"play")},b.prototype.vmStop=function(){w(this.vmPlayer,this.id,"pause")},b}(),B=function(a,b){return a===!1||"false"===a||0===a||"0"===a?a:a||b},f=function(a,b){return a===!1||"false"===a||0===a||"0"===a?!1:!!a||b},i=function(a){var b,c,d,e,f,g,h,j,k;if(b="",d="",a.attrs){j=a.attrs;for(e in j)f=j[e],b+=" "+e+'="'+f+'"'}if(a.children)for(k=a.children,g=0,h=k.length;h>g;g++)c=k[g],d+=u(c)?i(c):c;return"<"+a.tag+b+">"+(a.inner||d)+"</"+a.tag+">"},j=function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},v=function(a){return"string"==typeof a},s=function(a){return a instanceof Array},t=function(a){return a instanceof HTMLCollection},u=function(a){return null!==a&&"object"==typeof a},A=function(a){var b,c;for(b in a)return c=a[b],b},p=function(a){var b;return b="#"===a.charAt(0)?d.getElementById(a.substr(1)):d.getElementsByClassName(a.substr(1)),s(b)&&0===b.length?null:b},y=function(){return(Math.random().toString(36).slice(2)+Math.random().toString(36).slice(2)).substring(0,16)},x=function(a){return a=a.replace(/^#/,""),3===a.length?""+a+a:a},o=function(a){return"#"+x(a)},g=function(a){return{r:parseInt(x(a).substring(0,2),16),g:parseInt(x(a).substring(2,4),16),b:parseInt(x(a).substring(4,6),16)}},C="display: none; position: fixed; min-width: 100%; min-height: 100%; top: 0; right: 0; bottom: 0; left: 0;",D=function(a,b){return"display: none; position: fixed; width: "+a+"px; height: "+b+"px;"},n="position: absolute; top: 50%; left: 50%; background: #000000;",k=function(a,b){return a.style.transition=a.style.mozTransition=a.style.webkitTransition="opacity "+b+"ms ease"},l=function(a,b){var c;return k(a,b),a.style.display="block",c=function(){return a.style.opacity=1},setTimeout(c,20)},m=function(a,b){var c;return k(a,b),a.style.opacity=0,c=function(){return a.style.display="none"},setTimeout(c,b)},r=function(){var a,c,e;d.getElementById("ytScript")||(a=d.getElementsByTagName("script")[0],c=b.createElement("script"),c.innerHTML="function onYouTubeIframeAPIReady() {vlData.ytReady()};",a.parentNode.insertBefore(c,a),e=b.createElement("script"),e.id="ytScript",e.async=!0,e.src="//www.youtube.com/iframe_api",c.parentNode.insertBefore(e,c.nextSibling))},E=function(a,b){null==b&&(b=0),a.getDuration()-3<a.getCurrentTime()&&(a.pauseVideo(),a.seekTo(b,!1))},w=function(a,b,c,d){var e;return null==d&&(d=null),e=d?{method:c,value:d}:{method:c},a.contentWindow.postMessage(JSON.stringify(e),"http://player.vimeo.com/video/"+b)},h=function(a,b){var c;return c=d.createElement("img"),c.className="video-link",c.src=b,a.appendChild(c),c},z=function(){var a;return(a=b.getElementById("vl-size-test"))||(a=b.createElement("div"),a.id="vl-size-test",a.style.cssText="position:fixed;top:0;left:0;bottom:0;right:0;visibility:hidden;",b.body.appendChild(a)),{width:a.offsetWidth,height:a.offsetHeight}},q=function(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(null==d&&(d=30),g=a.getBoundingClientRect(),f={x:(i=z().width)/2,y:(h=z().height)/2},e={x:b/2,y:c/2},j=[],l=n=p=g.left,q=g.right+b;d>0?q>=n:n>=q;l=n+=d)j.push([l-b,g.top-c]),j.push([l-b,g.bottom]);for(m=o=r=g.top,s=g.bottom+c;d>0?s>=o:o>=s;m=o+=d)j.push([g.left-b,m-c]),j.push([g.right,m-c]);return k=function(a,d){var g,j,k,n,o,p,q,r;for(r=[[a,n={}],[d,o={}]],p=0,q=r.length;q>p;p++)g=r[p],l=g[0][0],m=g[0][1],g[1].diffx=(j=l+e.x)>f.x?j-f.x:f.x-j,g[1].diffy=(k=m+e.y)>f.y?k-f.y:f.y-k,g[1].diff=g[1].diffx+g[1].diffy,(0>l||l+b>i)&&(g[1].diff+=1e4),(0>m||m+c>h)&&(g[1].diff+=1e4);return n.diff-o.diff},j.sort(k),{x:parseInt((l=j[0][0])<0||l+b>i?f.x-e.x:l,10),y:parseInt((m=j[0][1])<0||m+c>h?f.y-e.y:m,10)}},this.videoLightning=e,this.vlData={},this.vlData.instances=[],this.vlData.ytReady=function(){var a,b,c,d,e;for(d=F.vlData.instances.filter(function(a){return"youtube"===a.vendor}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.initPlayerYT());return e},this.vlData.youtube=this.vlData.vimeo=!1,"undefined"!=typeof $?$.fn.jqueryVideoLightning=function(a){return this.each(function(){var b;$.data(this,"plugin_jqueryVideoLightning")||(b=new c({el:this,opts:a}),vlData.instances.push(b),$.data(this,"plugin_jqueryVideoLightning",b))}),r()}:void 0}(document)}).call(this);